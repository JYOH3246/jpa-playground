## 9.3 값 타입과 불변 객체
- 값 타입은 단순하고 안전하게 다룰 수 있어야 한다.

### 9.3.1 값 타입 공유 참조
- 임베디드 타입 같은 값 타입을 여러 엔티티에서 공유하면 위험하다.
```kotlin
var address = Address("OldCity")
member1.address = address

address.city = "NewCity" // 회원 1의 address 값을 공유해서 사용
member2.address = address
```
- 영속성 컨텍스트는 회원1과 회원2 둘 다 city 속성이 변경된 것으로 판단해서 회원1,2 각각 UPDATE SQL을 실행한다.

### 9.3.2 값 타입 복사
- 값 타입의 실제 인스턴스인 값을 공유하는 것은 위험하다. 대신에 값을 복사해서 사용해야 한다.
- 값을 복사해서 사용하면 공유 참조로 인해 발생하는 부작용을 피할 수 있다.
- 문제는 임베디드 타입처럼 직접 정의한 값 타입은 자바의 기본 타입이 아니라 객체타입이라는 것이다.
- 인스턴스를 복사해서 대입하면 공유 참조를 피할 수 있지만, 복사하지 않고 원본의 참조값을 넘기는 것을 막을 방법이 없다
- 근본적인 해결책 중 가장 단순한 방법은 Setter와 같은 수정자 메소드를 전부 제거해버리는 것이다.

### 9.3.3 불변 객체
- 객체를 불변하게 만들면 값을 수정할 수 없으므로 부작용을 원천 차단할 수 있다.
- 값 타입의 설계는 될 수 있으면 불변 객체로 설계해야 한다.